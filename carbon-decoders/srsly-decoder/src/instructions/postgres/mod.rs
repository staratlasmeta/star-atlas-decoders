//! This code was AUTOGENERATED using the Codama library.
pub mod accept_rental_row;
pub mod cancel_rental_row;
pub mod close_contract_row;
pub mod close_rental_row;
pub mod create_contract_row;
pub mod pay_rental_row;
pub mod reset_rental_row;

pub use self::accept_rental_row::*;
pub use self::cancel_rental_row::*;
pub use self::close_contract_row::*;
pub use self::close_rental_row::*;
pub use self::create_contract_row::*;
pub use self::pay_rental_row::*;
pub use self::reset_rental_row::*;

use super::SrslyInstruction;

pub struct SrslyInstructionsMigration;

impl sqlx_migrator::Migration<sqlx::Postgres> for SrslyInstructionsMigration {
    fn app(&self) -> &str {
        "srsly"
    }

    fn name(&self) -> &str {
        "srsly_instructions"
    }

    fn operations(&self) -> Vec<Box<dyn sqlx_migrator::Operation<sqlx::Postgres>>> {
        vec![
            Box::new(AcceptRentalMigrationOperation),
            Box::new(CancelRentalMigrationOperation),
            Box::new(CloseContractMigrationOperation),
            Box::new(CloseRentalMigrationOperation),
            Box::new(CreateContractMigrationOperation),
            Box::new(PayRentalMigrationOperation),
            Box::new(ResetRentalMigrationOperation),
        ]
    }

    fn parents(&self) -> Vec<Box<dyn sqlx_migrator::Migration<sqlx::Postgres>>> {
        vec![]
    }
}

pub struct SrslyInstructionWithMetadata(
    pub SrslyInstruction,
    pub carbon_core::instruction::InstructionMetadata,
);

impl
    From<(
        SrslyInstruction,
        carbon_core::instruction::InstructionMetadata,
    )> for SrslyInstructionWithMetadata
{
    fn from(
        value: (
            SrslyInstruction,
            carbon_core::instruction::InstructionMetadata,
        ),
    ) -> Self {
        SrslyInstructionWithMetadata(value.0, value.1)
    }
}

#[async_trait::async_trait]
impl carbon_core::postgres::operations::Insert for SrslyInstructionWithMetadata {
    async fn insert(&self, pool: &sqlx::PgPool) -> carbon_core::error::CarbonResult<()> {
        let SrslyInstructionWithMetadata(instruction, metadata) = self;
        match instruction {
            SrslyInstruction::AcceptRental(instruction) => {
                let row = accept_rental_row::AcceptRentalRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            SrslyInstruction::CancelRental(instruction) => {
                let row = cancel_rental_row::CancelRentalRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            SrslyInstruction::CloseContract(instruction) => {
                let row = close_contract_row::CloseContractRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            SrslyInstruction::CloseRental(instruction) => {
                let row = close_rental_row::CloseRentalRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            SrslyInstruction::CreateContract(instruction) => {
                let row = create_contract_row::CreateContractRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            SrslyInstruction::PayRental(instruction) => {
                let row =
                    pay_rental_row::PayRentalRow::from_parts(instruction.clone(), metadata.clone());
                row.insert(pool).await?;
                Ok(())
            }
            SrslyInstruction::ResetRental(instruction) => {
                let row = reset_rental_row::ResetRentalRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
        }
    }
}

#[async_trait::async_trait]
impl carbon_core::postgres::operations::Upsert for SrslyInstructionWithMetadata {
    async fn upsert(&self, pool: &sqlx::PgPool) -> carbon_core::error::CarbonResult<()> {
        let SrslyInstructionWithMetadata(instruction, metadata) = self;
        match instruction {
            SrslyInstruction::AcceptRental(instruction) => {
                let row = accept_rental_row::AcceptRentalRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            SrslyInstruction::CancelRental(instruction) => {
                let row = cancel_rental_row::CancelRentalRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            SrslyInstruction::CloseContract(instruction) => {
                let row = close_contract_row::CloseContractRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            SrslyInstruction::CloseRental(instruction) => {
                let row = close_rental_row::CloseRentalRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            SrslyInstruction::CreateContract(instruction) => {
                let row = create_contract_row::CreateContractRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            SrslyInstruction::PayRental(instruction) => {
                let row =
                    pay_rental_row::PayRentalRow::from_parts(instruction.clone(), metadata.clone());
                row.upsert(pool).await?;
                Ok(())
            }
            SrslyInstruction::ResetRental(instruction) => {
                let row = reset_rental_row::ResetRentalRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
        }
    }
}

//! This code was AUTOGENERATED using the Codama library.
use carbon_core::borsh;
use solana_pubkey::Pubkey;

use super::ProfilePermissions;

/// A key on a profile.

#[cfg_attr(feature = "serde", derive(serde::Serialize, serde::Deserialize))]
#[derive(Debug, Clone, borsh::BorshSerialize, borsh::BorshDeserialize, PartialEq)]
pub struct ProfileKey {
    /// The key.
    pub key: Pubkey,
    /// The key for the permissions.
    pub scope: Pubkey,
    /// The expire time for this key.
    /// If `<0` does not expire.
    pub expire_time: i64,
    /// The permissions for the key.
    pub permissions: [u8; 8],
}

impl ProfileKey {
    /// Convert the raw permission bytes to a u64 value.
    pub fn permissions_as_u64(&self) -> u64 {
        u64::from_le_bytes(self.permissions)
    }

    /// Get the permissions as a ProfilePermissions bitflags type.
    pub fn permissions_flags(&self) -> ProfilePermissions {
        ProfilePermissions::from_le_bytes(self.permissions)
    }

    /// Check if this key has a specific permission flag set.
    pub fn has_permission(&self, flag: ProfilePermissions) -> bool {
        self.permissions_flags().contains(flag)
    }

    /// Check if this key is an auth key (has AUTH permission).
    pub fn is_auth(&self) -> bool {
        self.has_permission(ProfilePermissions::AUTH)
    }

    /// Check if this key has expired based on the given current time.
    /// Keys with negative expire_time never expire.
    pub fn is_expired(&self, current_time: i64) -> bool {
        self.expire_time >= 0 && self.expire_time < current_time
    }
}

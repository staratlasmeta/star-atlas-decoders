//! This code was AUTOGENERATED using the Codama library.
pub mod add_point_category_level_row;
pub mod create_point_category_row;
pub mod create_user_point_account_row;
pub mod create_user_point_account_with_license_row;
pub mod decrement_level_row;
pub mod decrement_points_row;
pub mod deregister_point_modifier_row;
pub mod increment_level_beyond_threshold_row;
pub mod increment_level_row;
pub mod increment_points_row;
pub mod register_point_modifier_row;
pub mod remove_point_category_level_row;
pub mod spend_points_row;
pub mod update_point_category_row;

pub use self::add_point_category_level_row::*;
pub use self::create_point_category_row::*;
pub use self::create_user_point_account_row::*;
pub use self::create_user_point_account_with_license_row::*;
pub use self::decrement_level_row::*;
pub use self::decrement_points_row::*;
pub use self::deregister_point_modifier_row::*;
pub use self::increment_level_beyond_threshold_row::*;
pub use self::increment_level_row::*;
pub use self::increment_points_row::*;
pub use self::register_point_modifier_row::*;
pub use self::remove_point_category_level_row::*;
pub use self::spend_points_row::*;
pub use self::update_point_category_row::*;

use super::PointsInstruction;

pub struct PointsInstructionsMigration;

impl sqlx_migrator::Migration<sqlx::Postgres> for PointsInstructionsMigration {
    fn app(&self) -> &str {
        "points"
    }

    fn name(&self) -> &str {
        "points_instructions"
    }

    fn operations(&self) -> Vec<Box<dyn sqlx_migrator::Operation<sqlx::Postgres>>> {
        vec![
            Box::new(AddPointCategoryLevelMigrationOperation),
            Box::new(CreatePointCategoryMigrationOperation),
            Box::new(CreateUserPointAccountMigrationOperation),
            Box::new(CreateUserPointAccountWithLicenseMigrationOperation),
            Box::new(DecrementLevelMigrationOperation),
            Box::new(DecrementPointsMigrationOperation),
            Box::new(DeregisterPointModifierMigrationOperation),
            Box::new(IncrementLevelMigrationOperation),
            Box::new(IncrementLevelBeyondThresholdMigrationOperation),
            Box::new(IncrementPointsMigrationOperation),
            Box::new(RegisterPointModifierMigrationOperation),
            Box::new(RemovePointCategoryLevelMigrationOperation),
            Box::new(SpendPointsMigrationOperation),
            Box::new(UpdatePointCategoryMigrationOperation),
        ]
    }

    fn parents(&self) -> Vec<Box<dyn sqlx_migrator::Migration<sqlx::Postgres>>> {
        vec![]
    }
}

pub struct PointsInstructionWithMetadata(
    pub PointsInstruction,
    pub carbon_core::instruction::InstructionMetadata,
);

impl
    From<(
        PointsInstruction,
        carbon_core::instruction::InstructionMetadata,
    )> for PointsInstructionWithMetadata
{
    fn from(
        value: (
            PointsInstruction,
            carbon_core::instruction::InstructionMetadata,
        ),
    ) -> Self {
        PointsInstructionWithMetadata(value.0, value.1)
    }
}

#[async_trait::async_trait]
impl carbon_core::postgres::operations::Insert for PointsInstructionWithMetadata {
    async fn insert(&self, pool: &sqlx::PgPool) -> carbon_core::error::CarbonResult<()> {
        let PointsInstructionWithMetadata(instruction, metadata) = self;
        match instruction {
            PointsInstruction::AddPointCategoryLevel(instruction) => {
                let row = add_point_category_level_row::AddPointCategoryLevelRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            PointsInstruction::CreatePointCategory(instruction) => {
                let row = create_point_category_row::CreatePointCategoryRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            PointsInstruction::CreateUserPointAccount(instruction) => {
                let row = create_user_point_account_row::CreateUserPointAccountRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            PointsInstruction::CreateUserPointAccountWithLicense(instruction) => {
                let row = create_user_point_account_with_license_row::CreateUserPointAccountWithLicenseRow::from_parts(instruction.clone(), metadata.clone());
                row.insert(pool).await?;
                Ok(())
            }
            PointsInstruction::DecrementLevel(instruction) => {
                let row = decrement_level_row::DecrementLevelRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            PointsInstruction::DecrementPoints(instruction) => {
                let row = decrement_points_row::DecrementPointsRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            PointsInstruction::DeregisterPointModifier(instruction) => {
                let row = deregister_point_modifier_row::DeregisterPointModifierRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            PointsInstruction::IncrementLevel(instruction) => {
                let row = increment_level_row::IncrementLevelRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            PointsInstruction::IncrementLevelBeyondThreshold(instruction) => {
                let row = increment_level_beyond_threshold_row::IncrementLevelBeyondThresholdRow::from_parts(instruction.clone(), metadata.clone());
                row.insert(pool).await?;
                Ok(())
            }
            PointsInstruction::IncrementPoints(instruction) => {
                let row = increment_points_row::IncrementPointsRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            PointsInstruction::RegisterPointModifier(instruction) => {
                let row = register_point_modifier_row::RegisterPointModifierRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            PointsInstruction::RemovePointCategoryLevel(instruction) => {
                let row = remove_point_category_level_row::RemovePointCategoryLevelRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            PointsInstruction::SpendPoints(instruction) => {
                let row = spend_points_row::SpendPointsRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            PointsInstruction::UpdatePointCategory(instruction) => {
                let row = update_point_category_row::UpdatePointCategoryRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
        }
    }
}

#[async_trait::async_trait]
impl carbon_core::postgres::operations::Upsert for PointsInstructionWithMetadata {
    async fn upsert(&self, pool: &sqlx::PgPool) -> carbon_core::error::CarbonResult<()> {
        let PointsInstructionWithMetadata(instruction, metadata) = self;
        match instruction {
            PointsInstruction::AddPointCategoryLevel(instruction) => {
                let row = add_point_category_level_row::AddPointCategoryLevelRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            PointsInstruction::CreatePointCategory(instruction) => {
                let row = create_point_category_row::CreatePointCategoryRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            PointsInstruction::CreateUserPointAccount(instruction) => {
                let row = create_user_point_account_row::CreateUserPointAccountRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            PointsInstruction::CreateUserPointAccountWithLicense(instruction) => {
                let row = create_user_point_account_with_license_row::CreateUserPointAccountWithLicenseRow::from_parts(instruction.clone(), metadata.clone());
                row.upsert(pool).await?;
                Ok(())
            }
            PointsInstruction::DecrementLevel(instruction) => {
                let row = decrement_level_row::DecrementLevelRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            PointsInstruction::DecrementPoints(instruction) => {
                let row = decrement_points_row::DecrementPointsRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            PointsInstruction::DeregisterPointModifier(instruction) => {
                let row = deregister_point_modifier_row::DeregisterPointModifierRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            PointsInstruction::IncrementLevel(instruction) => {
                let row = increment_level_row::IncrementLevelRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            PointsInstruction::IncrementLevelBeyondThreshold(instruction) => {
                let row = increment_level_beyond_threshold_row::IncrementLevelBeyondThresholdRow::from_parts(instruction.clone(), metadata.clone());
                row.upsert(pool).await?;
                Ok(())
            }
            PointsInstruction::IncrementPoints(instruction) => {
                let row = increment_points_row::IncrementPointsRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            PointsInstruction::RegisterPointModifier(instruction) => {
                let row = register_point_modifier_row::RegisterPointModifierRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            PointsInstruction::RemovePointCategoryLevel(instruction) => {
                let row = remove_point_category_level_row::RemovePointCategoryLevelRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            PointsInstruction::SpendPoints(instruction) => {
                let row = spend_points_row::SpendPointsRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            PointsInstruction::UpdatePointCategory(instruction) => {
                let row = update_point_category_row::UpdatePointCategoryRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
        }
    }
}

//! This code was AUTOGENERATED using the Codama library.
pub mod close_fee_payer_row;
pub mod create_fee_payer_rates_row;
pub mod create_fee_payer_row;
pub mod post_transaction_no_vault_row;
pub mod post_transaction_row;
pub mod pre_transaction_row;
pub mod set_fee_payer_rates_row;

pub use self::close_fee_payer_row::*;
pub use self::create_fee_payer_rates_row::*;
pub use self::create_fee_payer_row::*;
pub use self::post_transaction_no_vault_row::*;
pub use self::post_transaction_row::*;
pub use self::pre_transaction_row::*;
pub use self::set_fee_payer_rates_row::*;

use super::AtlasFeePayerInstruction;

pub struct AtlasFeePayerInstructionsMigration;

impl sqlx_migrator::Migration<sqlx::Postgres> for AtlasFeePayerInstructionsMigration {
    fn app(&self) -> &str {
        "atlas-fee-payer"
    }

    fn name(&self) -> &str {
        "atlas_fee_payer_instructions"
    }

    fn operations(&self) -> Vec<Box<dyn sqlx_migrator::Operation<sqlx::Postgres>>> {
        vec![
            Box::new(CloseFeePayerMigrationOperation),
            Box::new(CreateFeePayerMigrationOperation),
            Box::new(CreateFeePayerRatesMigrationOperation),
            Box::new(PostTransactionMigrationOperation),
            Box::new(PostTransactionNoVaultMigrationOperation),
            Box::new(PreTransactionMigrationOperation),
            Box::new(SetFeePayerRatesMigrationOperation),
        ]
    }

    fn parents(&self) -> Vec<Box<dyn sqlx_migrator::Migration<sqlx::Postgres>>> {
        vec![]
    }
}

pub struct AtlasFeePayerInstructionWithMetadata(
    pub AtlasFeePayerInstruction,
    pub carbon_core::instruction::InstructionMetadata,
);

impl
    From<(
        AtlasFeePayerInstruction,
        carbon_core::instruction::InstructionMetadata,
    )> for AtlasFeePayerInstructionWithMetadata
{
    fn from(
        value: (
            AtlasFeePayerInstruction,
            carbon_core::instruction::InstructionMetadata,
        ),
    ) -> Self {
        AtlasFeePayerInstructionWithMetadata(value.0, value.1)
    }
}

#[async_trait::async_trait]
impl carbon_core::postgres::operations::Insert for AtlasFeePayerInstructionWithMetadata {
    async fn insert(&self, pool: &sqlx::PgPool) -> carbon_core::error::CarbonResult<()> {
        let AtlasFeePayerInstructionWithMetadata(instruction, metadata) = self;
        match instruction {
            AtlasFeePayerInstruction::CloseFeePayer(instruction) => {
                let row = close_fee_payer_row::CloseFeePayerRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            AtlasFeePayerInstruction::CreateFeePayer(instruction) => {
                let row = create_fee_payer_row::CreateFeePayerRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            AtlasFeePayerInstruction::CreateFeePayerRates(instruction) => {
                let row = create_fee_payer_rates_row::CreateFeePayerRatesRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            AtlasFeePayerInstruction::PostTransaction(instruction) => {
                let row = post_transaction_row::PostTransactionRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            AtlasFeePayerInstruction::PostTransactionNoVault(instruction) => {
                let row = post_transaction_no_vault_row::PostTransactionNoVaultRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            AtlasFeePayerInstruction::PreTransaction(instruction) => {
                let row = pre_transaction_row::PreTransactionRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            AtlasFeePayerInstruction::SetFeePayerRates(instruction) => {
                let row = set_fee_payer_rates_row::SetFeePayerRatesRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
        }
    }
}

#[async_trait::async_trait]
impl carbon_core::postgres::operations::Upsert for AtlasFeePayerInstructionWithMetadata {
    async fn upsert(&self, pool: &sqlx::PgPool) -> carbon_core::error::CarbonResult<()> {
        let AtlasFeePayerInstructionWithMetadata(instruction, metadata) = self;
        match instruction {
            AtlasFeePayerInstruction::CloseFeePayer(instruction) => {
                let row = close_fee_payer_row::CloseFeePayerRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            AtlasFeePayerInstruction::CreateFeePayer(instruction) => {
                let row = create_fee_payer_row::CreateFeePayerRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            AtlasFeePayerInstruction::CreateFeePayerRates(instruction) => {
                let row = create_fee_payer_rates_row::CreateFeePayerRatesRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            AtlasFeePayerInstruction::PostTransaction(instruction) => {
                let row = post_transaction_row::PostTransactionRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            AtlasFeePayerInstruction::PostTransactionNoVault(instruction) => {
                let row = post_transaction_no_vault_row::PostTransactionNoVaultRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            AtlasFeePayerInstruction::PreTransaction(instruction) => {
                let row = pre_transaction_row::PreTransactionRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            AtlasFeePayerInstruction::SetFeePayerRates(instruction) => {
                let row = set_fee_payer_rates_row::SetFeePayerRatesRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
        }
    }
}

//! This code was AUTOGENERATED using the Codama library.
pub mod combat_config_row;
pub mod crafting_instance_row;
pub mod disbanded_fleet_row;
pub mod fleet_row;
pub mod fleet_ships_row;
pub mod game_row;
pub mod game_state_row;
pub mod loot_row;
pub mod mine_item_row;
pub mod planet_row;
pub mod player_crew_record_row;
pub mod progression_config_row;
pub mod resource_row;
pub mod sage_crew_config_row;
pub mod sage_player_profile_row;
pub mod sector_row;
pub mod ship_row;
pub mod star_row;
pub mod starbase_player_row;
pub mod starbase_row;
pub mod survey_data_unit_tracker_row;

pub use self::combat_config_row::*;
pub use self::crafting_instance_row::*;
pub use self::disbanded_fleet_row::*;
pub use self::fleet_row::*;
pub use self::fleet_ships_row::*;
pub use self::game_row::*;
pub use self::game_state_row::*;
pub use self::loot_row::*;
pub use self::mine_item_row::*;
pub use self::planet_row::*;
pub use self::player_crew_record_row::*;
pub use self::progression_config_row::*;
pub use self::resource_row::*;
pub use self::sage_crew_config_row::*;
pub use self::sage_player_profile_row::*;
pub use self::sector_row::*;
pub use self::ship_row::*;
pub use self::star_row::*;
pub use self::starbase_player_row::*;
pub use self::starbase_row::*;
pub use self::survey_data_unit_tracker_row::*;

use super::SageAccount;

pub struct SageAccountsMigration;

impl sqlx_migrator::Migration<sqlx::Postgres> for SageAccountsMigration {
    fn app(&self) -> &str {
        "sage"
    }

    fn name(&self) -> &str {
        "sage_accounts"
    }

    fn operations(&self) -> Vec<Box<dyn sqlx_migrator::Operation<sqlx::Postgres>>> {
        vec![
            Box::new(CombatConfigMigrationOperation),
            Box::new(CraftingInstanceMigrationOperation),
            Box::new(DisbandedFleetMigrationOperation),
            Box::new(FleetMigrationOperation),
            Box::new(FleetShipsMigrationOperation),
            Box::new(GameMigrationOperation),
            Box::new(GameStateMigrationOperation),
            Box::new(LootMigrationOperation),
            Box::new(MineItemMigrationOperation),
            Box::new(PlanetMigrationOperation),
            Box::new(PlayerCrewRecordMigrationOperation),
            Box::new(ProgressionConfigMigrationOperation),
            Box::new(ResourceMigrationOperation),
            Box::new(SageCrewConfigMigrationOperation),
            Box::new(SagePlayerProfileMigrationOperation),
            Box::new(SectorMigrationOperation),
            Box::new(ShipMigrationOperation),
            Box::new(StarMigrationOperation),
            Box::new(StarbaseMigrationOperation),
            Box::new(StarbasePlayerMigrationOperation),
            Box::new(SurveyDataUnitTrackerMigrationOperation),
        ]
    }

    fn parents(&self) -> Vec<Box<dyn sqlx_migrator::Migration<sqlx::Postgres>>> {
        vec![]
    }
}

pub struct SageAccountWithMetadata(pub SageAccount, pub carbon_core::account::AccountMetadata);

impl From<(SageAccount, carbon_core::account::AccountMetadata)> for SageAccountWithMetadata {
    fn from(value: (SageAccount, carbon_core::account::AccountMetadata)) -> Self {
        SageAccountWithMetadata(value.0, value.1)
    }
}

#[async_trait::async_trait]
impl carbon_core::postgres::operations::Insert for SageAccountWithMetadata {
    async fn insert(&self, pool: &sqlx::PgPool) -> carbon_core::error::CarbonResult<()> {
        let SageAccountWithMetadata(account, metadata) = self;

        match account {
            SageAccount::CombatConfig(account) => {
                let row = combat_config_row::CombatConfigRow::from_parts(
                    *account.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            SageAccount::CraftingInstance(account) => {
                let row = crafting_instance_row::CraftingInstanceRow::from_parts(
                    *account.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            SageAccount::DisbandedFleet(account) => {
                let row = disbanded_fleet_row::DisbandedFleetRow::from_parts(
                    *account.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            SageAccount::Fleet(account) => {
                let row = fleet_row::FleetRow::from_parts(*account.clone(), metadata.clone());
                row.insert(pool).await?;
                Ok(())
            }
            SageAccount::FleetShips(account) => {
                let row =
                    fleet_ships_row::FleetShipsRow::from_parts(*account.clone(), metadata.clone());
                row.insert(pool).await?;
                Ok(())
            }
            SageAccount::Game(account) => {
                let row = game_row::GameRow::from_parts(*account.clone(), metadata.clone());
                row.insert(pool).await?;
                Ok(())
            }
            SageAccount::GameState(account) => {
                let row =
                    game_state_row::GameStateRow::from_parts(*account.clone(), metadata.clone());
                row.insert(pool).await?;
                Ok(())
            }
            SageAccount::Loot(account) => {
                let row = loot_row::LootRow::from_parts(*account.clone(), metadata.clone());
                row.insert(pool).await?;
                Ok(())
            }
            SageAccount::MineItem(account) => {
                let row =
                    mine_item_row::MineItemRow::from_parts(*account.clone(), metadata.clone());
                row.insert(pool).await?;
                Ok(())
            }
            SageAccount::Planet(account) => {
                let row = planet_row::PlanetRow::from_parts(*account.clone(), metadata.clone());
                row.insert(pool).await?;
                Ok(())
            }
            SageAccount::PlayerCrewRecord(account) => {
                let row = player_crew_record_row::PlayerCrewRecordRow::from_parts(
                    *account.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            SageAccount::ProgressionConfig(account) => {
                let row = progression_config_row::ProgressionConfigRow::from_parts(
                    *account.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            SageAccount::Resource(account) => {
                let row = resource_row::ResourceRow::from_parts(*account.clone(), metadata.clone());
                row.insert(pool).await?;
                Ok(())
            }
            SageAccount::SageCrewConfig(account) => {
                let row = sage_crew_config_row::SageCrewConfigRow::from_parts(
                    *account.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            SageAccount::SagePlayerProfile(account) => {
                let row = sage_player_profile_row::SagePlayerProfileRow::from_parts(
                    *account.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            SageAccount::Sector(account) => {
                let row = sector_row::SectorRow::from_parts(*account.clone(), metadata.clone());
                row.insert(pool).await?;
                Ok(())
            }
            SageAccount::Ship(account) => {
                let row = ship_row::ShipRow::from_parts(*account.clone(), metadata.clone());
                row.insert(pool).await?;
                Ok(())
            }
            SageAccount::Star(account) => {
                let row = star_row::StarRow::from_parts(*account.clone(), metadata.clone());
                row.insert(pool).await?;
                Ok(())
            }
            SageAccount::Starbase(account) => {
                let row = starbase_row::StarbaseRow::from_parts(*account.clone(), metadata.clone());
                row.insert(pool).await?;
                Ok(())
            }
            SageAccount::StarbasePlayer(account) => {
                let row = starbase_player_row::StarbasePlayerRow::from_parts(
                    *account.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            SageAccount::SurveyDataUnitTracker(account) => {
                let row = survey_data_unit_tracker_row::SurveyDataUnitTrackerRow::from_parts(
                    *account.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
        }
    }
}

#[async_trait::async_trait]
impl carbon_core::postgres::operations::Upsert for SageAccountWithMetadata {
    async fn upsert(&self, pool: &sqlx::PgPool) -> carbon_core::error::CarbonResult<()> {
        let SageAccountWithMetadata(account, metadata) = self;
        match account {
            SageAccount::CombatConfig(account) => {
                let row = combat_config_row::CombatConfigRow::from_parts(
                    *account.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            SageAccount::CraftingInstance(account) => {
                let row = crafting_instance_row::CraftingInstanceRow::from_parts(
                    *account.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            SageAccount::DisbandedFleet(account) => {
                let row = disbanded_fleet_row::DisbandedFleetRow::from_parts(
                    *account.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            SageAccount::Fleet(account) => {
                let row = fleet_row::FleetRow::from_parts(*account.clone(), metadata.clone());
                row.upsert(pool).await?;
                Ok(())
            }
            SageAccount::FleetShips(account) => {
                let row =
                    fleet_ships_row::FleetShipsRow::from_parts(*account.clone(), metadata.clone());
                row.upsert(pool).await?;
                Ok(())
            }
            SageAccount::Game(account) => {
                let row = game_row::GameRow::from_parts(*account.clone(), metadata.clone());
                row.upsert(pool).await?;
                Ok(())
            }
            SageAccount::GameState(account) => {
                let row =
                    game_state_row::GameStateRow::from_parts(*account.clone(), metadata.clone());
                row.upsert(pool).await?;
                Ok(())
            }
            SageAccount::Loot(account) => {
                let row = loot_row::LootRow::from_parts(*account.clone(), metadata.clone());
                row.upsert(pool).await?;
                Ok(())
            }
            SageAccount::MineItem(account) => {
                let row =
                    mine_item_row::MineItemRow::from_parts(*account.clone(), metadata.clone());
                row.upsert(pool).await?;
                Ok(())
            }
            SageAccount::Planet(account) => {
                let row = planet_row::PlanetRow::from_parts(*account.clone(), metadata.clone());
                row.upsert(pool).await?;
                Ok(())
            }
            SageAccount::PlayerCrewRecord(account) => {
                let row = player_crew_record_row::PlayerCrewRecordRow::from_parts(
                    *account.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            SageAccount::ProgressionConfig(account) => {
                let row = progression_config_row::ProgressionConfigRow::from_parts(
                    *account.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            SageAccount::Resource(account) => {
                let row = resource_row::ResourceRow::from_parts(*account.clone(), metadata.clone());
                row.upsert(pool).await?;
                Ok(())
            }
            SageAccount::SageCrewConfig(account) => {
                let row = sage_crew_config_row::SageCrewConfigRow::from_parts(
                    *account.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            SageAccount::SagePlayerProfile(account) => {
                let row = sage_player_profile_row::SagePlayerProfileRow::from_parts(
                    *account.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            SageAccount::Sector(account) => {
                let row = sector_row::SectorRow::from_parts(*account.clone(), metadata.clone());
                row.upsert(pool).await?;
                Ok(())
            }
            SageAccount::Ship(account) => {
                let row = ship_row::ShipRow::from_parts(*account.clone(), metadata.clone());
                row.upsert(pool).await?;
                Ok(())
            }
            SageAccount::Star(account) => {
                let row = star_row::StarRow::from_parts(*account.clone(), metadata.clone());
                row.upsert(pool).await?;
                Ok(())
            }
            SageAccount::Starbase(account) => {
                let row = starbase_row::StarbaseRow::from_parts(*account.clone(), metadata.clone());
                row.upsert(pool).await?;
                Ok(())
            }
            SageAccount::StarbasePlayer(account) => {
                let row = starbase_player_row::StarbasePlayerRow::from_parts(
                    *account.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            SageAccount::SurveyDataUnitTracker(account) => {
                let row = survey_data_unit_tracker_row::SurveyDataUnitTrackerRow::from_parts(
                    *account.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
        }
    }
}

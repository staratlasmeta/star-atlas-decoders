//! This code was AUTOGENERATED using the Codama library.
pub mod mint_crew_member_row;
pub mod redeem_crew_pack_row;
pub mod register_crew_config_row;
pub mod register_pack_tiers_row;
pub mod register_pack_type_row;
pub mod register_sft_redemption_row;
pub mod update_pack_tiers_row;

pub use self::mint_crew_member_row::*;
pub use self::redeem_crew_pack_row::*;
pub use self::register_crew_config_row::*;
pub use self::register_pack_tiers_row::*;
pub use self::register_pack_type_row::*;
pub use self::register_sft_redemption_row::*;
pub use self::update_pack_tiers_row::*;

use super::CrewInstruction;

pub struct CrewInstructionsMigration;

impl sqlx_migrator::Migration<sqlx::Postgres> for CrewInstructionsMigration {
    fn app(&self) -> &str {
        "crew"
    }

    fn name(&self) -> &str {
        "crew_instructions"
    }

    fn operations(&self) -> Vec<Box<dyn sqlx_migrator::Operation<sqlx::Postgres>>> {
        vec![
            Box::new(MintCrewMemberMigrationOperation),
            Box::new(RedeemCrewPackMigrationOperation),
            Box::new(RegisterCrewConfigMigrationOperation),
            Box::new(RegisterPackTiersMigrationOperation),
            Box::new(RegisterPackTypeMigrationOperation),
            Box::new(RegisterSftRedemptionMigrationOperation),
            Box::new(UpdatePackTiersMigrationOperation),
        ]
    }

    fn parents(&self) -> Vec<Box<dyn sqlx_migrator::Migration<sqlx::Postgres>>> {
        vec![]
    }
}

pub struct CrewInstructionWithMetadata(
    pub CrewInstruction,
    pub carbon_core::instruction::InstructionMetadata,
);

impl
    From<(
        CrewInstruction,
        carbon_core::instruction::InstructionMetadata,
    )> for CrewInstructionWithMetadata
{
    fn from(
        value: (
            CrewInstruction,
            carbon_core::instruction::InstructionMetadata,
        ),
    ) -> Self {
        CrewInstructionWithMetadata(value.0, value.1)
    }
}

#[async_trait::async_trait]
impl carbon_core::postgres::operations::Insert for CrewInstructionWithMetadata {
    async fn insert(&self, pool: &sqlx::PgPool) -> carbon_core::error::CarbonResult<()> {
        let CrewInstructionWithMetadata(instruction, metadata) = self;
        match instruction {
            CrewInstruction::MintCrewMember(instruction) => {
                let row = mint_crew_member_row::MintCrewMemberRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            CrewInstruction::RedeemCrewPack(instruction) => {
                let row = redeem_crew_pack_row::RedeemCrewPackRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            CrewInstruction::RegisterCrewConfig(instruction) => {
                let row = register_crew_config_row::RegisterCrewConfigRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            CrewInstruction::RegisterPackTiers(instruction) => {
                let row = register_pack_tiers_row::RegisterPackTiersRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            CrewInstruction::RegisterPackType(instruction) => {
                let row = register_pack_type_row::RegisterPackTypeRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            CrewInstruction::RegisterSftRedemption(instruction) => {
                let row = register_sft_redemption_row::RegisterSftRedemptionRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            CrewInstruction::UpdatePackTiers(instruction) => {
                let row = update_pack_tiers_row::UpdatePackTiersRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
        }
    }
}

#[async_trait::async_trait]
impl carbon_core::postgres::operations::Upsert for CrewInstructionWithMetadata {
    async fn upsert(&self, pool: &sqlx::PgPool) -> carbon_core::error::CarbonResult<()> {
        let CrewInstructionWithMetadata(instruction, metadata) = self;
        match instruction {
            CrewInstruction::MintCrewMember(instruction) => {
                let row = mint_crew_member_row::MintCrewMemberRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            CrewInstruction::RedeemCrewPack(instruction) => {
                let row = redeem_crew_pack_row::RedeemCrewPackRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            CrewInstruction::RegisterCrewConfig(instruction) => {
                let row = register_crew_config_row::RegisterCrewConfigRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            CrewInstruction::RegisterPackTiers(instruction) => {
                let row = register_pack_tiers_row::RegisterPackTiersRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            CrewInstruction::RegisterPackType(instruction) => {
                let row = register_pack_type_row::RegisterPackTypeRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            CrewInstruction::RegisterSftRedemption(instruction) => {
                let row = register_sft_redemption_row::RegisterSftRedemptionRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            CrewInstruction::UpdatePackTiers(instruction) => {
                let row = update_pack_tiers_row::UpdatePackTiersRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
        }
    }
}

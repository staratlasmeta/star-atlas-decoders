//! This code was AUTOGENERATED using the Codama library.
pub mod add_redemption_epoch_row;
pub mod buy_row;
pub mod change_store_price_row;
pub mod claim_tokens_row;
pub mod close_redemption_config_row;
pub mod close_store_row;
pub mod contribute_to_redemption_row;
pub mod create_points_store_row;
pub mod create_redemption_config_row;
pub mod remove_redemption_epoch_row;
pub mod remove_store_items_row;
pub mod start_redemption_row;
pub mod update_redemption_epoch_row;

pub use self::add_redemption_epoch_row::*;
pub use self::buy_row::*;
pub use self::change_store_price_row::*;
pub use self::claim_tokens_row::*;
pub use self::close_redemption_config_row::*;
pub use self::close_store_row::*;
pub use self::contribute_to_redemption_row::*;
pub use self::create_points_store_row::*;
pub use self::create_redemption_config_row::*;
pub use self::remove_redemption_epoch_row::*;
pub use self::remove_store_items_row::*;
pub use self::start_redemption_row::*;
pub use self::update_redemption_epoch_row::*;

use super::PointsStoreInstruction;

pub struct PointsStoreInstructionsMigration;

impl sqlx_migrator::Migration<sqlx::Postgres> for PointsStoreInstructionsMigration {
    fn app(&self) -> &str {
        "points-store"
    }

    fn name(&self) -> &str {
        "points_store_instructions"
    }

    fn operations(&self) -> Vec<Box<dyn sqlx_migrator::Operation<sqlx::Postgres>>> {
        vec![
            Box::new(AddRedemptionEpochMigrationOperation),
            Box::new(BuyMigrationOperation),
            Box::new(ChangeStorePriceMigrationOperation),
            Box::new(ClaimTokensMigrationOperation),
            Box::new(CloseRedemptionConfigMigrationOperation),
            Box::new(CloseStoreMigrationOperation),
            Box::new(ContributeToRedemptionMigrationOperation),
            Box::new(CreatePointsStoreMigrationOperation),
            Box::new(CreateRedemptionConfigMigrationOperation),
            Box::new(RemoveRedemptionEpochMigrationOperation),
            Box::new(RemoveStoreItemsMigrationOperation),
            Box::new(StartRedemptionMigrationOperation),
            Box::new(UpdateRedemptionEpochMigrationOperation),
        ]
    }

    fn parents(&self) -> Vec<Box<dyn sqlx_migrator::Migration<sqlx::Postgres>>> {
        vec![]
    }
}

pub struct PointsStoreInstructionWithMetadata(
    pub PointsStoreInstruction,
    pub carbon_core::instruction::InstructionMetadata,
);

impl
    From<(
        PointsStoreInstruction,
        carbon_core::instruction::InstructionMetadata,
    )> for PointsStoreInstructionWithMetadata
{
    fn from(
        value: (
            PointsStoreInstruction,
            carbon_core::instruction::InstructionMetadata,
        ),
    ) -> Self {
        PointsStoreInstructionWithMetadata(value.0, value.1)
    }
}

#[async_trait::async_trait]
impl carbon_core::postgres::operations::Insert for PointsStoreInstructionWithMetadata {
    async fn insert(&self, pool: &sqlx::PgPool) -> carbon_core::error::CarbonResult<()> {
        let PointsStoreInstructionWithMetadata(instruction, metadata) = self;
        match instruction {
            PointsStoreInstruction::AddRedemptionEpoch(instruction) => {
                let row = add_redemption_epoch_row::AddRedemptionEpochRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            PointsStoreInstruction::Buy(instruction) => {
                let row = buy_row::BuyRow::from_parts(instruction.clone(), metadata.clone());
                row.insert(pool).await?;
                Ok(())
            }
            PointsStoreInstruction::ChangeStorePrice(instruction) => {
                let row = change_store_price_row::ChangeStorePriceRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            PointsStoreInstruction::ClaimTokens(instruction) => {
                let row = claim_tokens_row::ClaimTokensRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            PointsStoreInstruction::CloseRedemptionConfig(instruction) => {
                let row = close_redemption_config_row::CloseRedemptionConfigRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            PointsStoreInstruction::CloseStore(instruction) => {
                let row = close_store_row::CloseStoreRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            PointsStoreInstruction::ContributeToRedemption(instruction) => {
                let row = contribute_to_redemption_row::ContributeToRedemptionRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            PointsStoreInstruction::CreatePointsStore(instruction) => {
                let row = create_points_store_row::CreatePointsStoreRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            PointsStoreInstruction::CreateRedemptionConfig(instruction) => {
                let row = create_redemption_config_row::CreateRedemptionConfigRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            PointsStoreInstruction::RemoveRedemptionEpoch(instruction) => {
                let row = remove_redemption_epoch_row::RemoveRedemptionEpochRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            PointsStoreInstruction::RemoveStoreItems(instruction) => {
                let row = remove_store_items_row::RemoveStoreItemsRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            PointsStoreInstruction::StartRedemption(instruction) => {
                let row = start_redemption_row::StartRedemptionRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
            PointsStoreInstruction::UpdateRedemptionEpoch(instruction) => {
                let row = update_redemption_epoch_row::UpdateRedemptionEpochRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.insert(pool).await?;
                Ok(())
            }
        }
    }
}

#[async_trait::async_trait]
impl carbon_core::postgres::operations::Upsert for PointsStoreInstructionWithMetadata {
    async fn upsert(&self, pool: &sqlx::PgPool) -> carbon_core::error::CarbonResult<()> {
        let PointsStoreInstructionWithMetadata(instruction, metadata) = self;
        match instruction {
            PointsStoreInstruction::AddRedemptionEpoch(instruction) => {
                let row = add_redemption_epoch_row::AddRedemptionEpochRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            PointsStoreInstruction::Buy(instruction) => {
                let row = buy_row::BuyRow::from_parts(instruction.clone(), metadata.clone());
                row.upsert(pool).await?;
                Ok(())
            }
            PointsStoreInstruction::ChangeStorePrice(instruction) => {
                let row = change_store_price_row::ChangeStorePriceRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            PointsStoreInstruction::ClaimTokens(instruction) => {
                let row = claim_tokens_row::ClaimTokensRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            PointsStoreInstruction::CloseRedemptionConfig(instruction) => {
                let row = close_redemption_config_row::CloseRedemptionConfigRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            PointsStoreInstruction::CloseStore(instruction) => {
                let row = close_store_row::CloseStoreRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            PointsStoreInstruction::ContributeToRedemption(instruction) => {
                let row = contribute_to_redemption_row::ContributeToRedemptionRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            PointsStoreInstruction::CreatePointsStore(instruction) => {
                let row = create_points_store_row::CreatePointsStoreRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            PointsStoreInstruction::CreateRedemptionConfig(instruction) => {
                let row = create_redemption_config_row::CreateRedemptionConfigRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            PointsStoreInstruction::RemoveRedemptionEpoch(instruction) => {
                let row = remove_redemption_epoch_row::RemoveRedemptionEpochRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            PointsStoreInstruction::RemoveStoreItems(instruction) => {
                let row = remove_store_items_row::RemoveStoreItemsRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            PointsStoreInstruction::StartRedemption(instruction) => {
                let row = start_redemption_row::StartRedemptionRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
            PointsStoreInstruction::UpdateRedemptionEpoch(instruction) => {
                let row = update_redemption_epoch_row::UpdateRedemptionEpochRow::from_parts(
                    instruction.clone(),
                    metadata.clone(),
                );
                row.upsert(pool).await?;
                Ok(())
            }
        }
    }
}
